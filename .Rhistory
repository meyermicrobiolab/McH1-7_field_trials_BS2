theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Treatment") +coord_fixed()
p1
pdf("PCA_Aug.pdf",bg ="white",width = 8.5)
p1<-ggplot(df_out.aug,aes(x=PC1,y=PC2,color=samples$Treatment,shape=samples$Condition))
p1<-p1+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Treatment") +coord_fixed()
p1
dev.off()
type<-as.character(samples$Treatment)
cond<-as.character(samples$Condition)
# permanova between groups using Aitchison distance
dist.clr <- dist(E.clr)
perm<-adonis2(dist.clr~Condition*Treatment,as(sample_data(ps5_BS2),"data.frame"))
perm<-adonis2(dist.clr~Condition*Treatment,as(sample_data(ps5_BS2_aug),"data.frame"))
perm<-adonis2(dist.clr~Condition,as(sample_data(ps5_BS2_aug),"data.frame"))
print(perm)
otu <- read.table("silva_nochloronomito_otu_table_ps5_BS2_oct.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps5_BS2_oct.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps5_BS2_oct.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps5_BS2_oct <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps5_BS2_oct
d.czm <- cmultRepl(t(otu), method="CZM", label=0, z.warning=1)
d.clr <- codaSeq.clr(d.czm)
E.clr <- t(d.clr)
d.pcx <- prcomp(E.clr)
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
df_out.oct <- as.data.frame(d.pcx$x)
theme_set(theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()))
cols<-c("resistant"="#000000","none"="#999999","probiotic paste"="#D55E00","probiotic bag"="#E69F00","control paste"="#0072B2","control bag"="#56B4E9")
samples$Treatment<-factor(samples$Treatment,levels=c("probiotic bag","probiotic paste","control bag","control paste","none","resistant"))
samples$Condition<-factor(samples$Condition,levels=c("HH","HD","DD"))
p2<-ggplot(df_out.oct,aes(x=PC1,y=PC2,color=samples$Treatment,shape=samples$Condition))
p2<-p2+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Treatment") +coord_fixed()
p2
pdf("PCA_Oct.pdf",bg ="white",width = 8.5)
p2<-ggplot(df_out.oct,aes(x=PC1,y=PC2,color=samples$Treatment,shape=samples$Condition))
p2<-p2+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Treatment") +coord_fixed()
p2
dev.off()
type<-as.character(samples$Treatment)
frac<-as.character(samples$Collection.month)
cond<-as.character(samples$Condition)
# permanova between groups using Aitchison distance
dist.clr <- dist(E.clr)
perm<-adonis2(dist.clr~Condition*Treatment,as(sample_data(ps5_BS2_oct),"data.frame"))
print(perm)
otu <- read.table("silva_nochloronomito_otu_table_ps5_BS2_jan.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps5_BS2_jan.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps5_BS2_jan.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps5_BS2_jan <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps5_BS2_jan
d.czm <- cmultRepl(t(otu), method="CZM", label=0, z.warning=1)
d.clr <- codaSeq.clr(d.czm)
E.clr <- t(d.clr)
d.pcx <- prcomp(E.clr)
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
df_out.jan <- as.data.frame(d.pcx$x)
theme_set(theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()))
cols<-c("resistant"="#000000","none"="#999999","probiotic paste"="#D55E00","probiotic bag"="#E69F00","control paste"="#0072B2","control bag"="#56B4E9")
samples$Treatment<-factor(samples$Treatment,levels=c("probiotic bag","probiotic paste","control bag","control paste","none","resistant"))
samples$Condition<-factor(samples$Condition,levels=c("HH","HD","DD"))
p3<-ggplot(df_out.jan,aes(x=PC1,y=PC2,color=samples$Treatment,shape=samples$Treatment))
p3<-p3+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
lab
p3<-ggplot(df_out.jan,aes(x=PC1,y=PC2,color=samples$Treatment,shape=samples$Treatment))
p3<-p3+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Treatment") +coord_fixed()
p3
p3<-ggplot(df_out.jan,aes(x=PC1,y=PC2,color=samples$Treatment,shape=samples$Condition))
p3<-p3+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Treatment") +coord_fixed()
p3
pdf("PCA_Jan.pdf",bg ="white",width = 8.5)
p3<-ggplot(df_out.jan,aes(x=PC1,y=PC2,color=samples$Treatment,shape=samples$Condition))
p3<-p3+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Treatment") +coord_fixed()
p3
dev.off()
dist.clr <- dist(E.clr)
perm<-adonis2(dist.clr~Condition*Treatment,as(sample_data(ps5_BS2_jan),"data.frame"))
print(perm)
#clear data and read in just what is needed for plotting
cols<-c("resistant"="#000000","none"="#999999","probiotic paste"="#D55E00","probiotic bag"="#E69F00","control paste"="#0072B2","control bag"="#56B4E9")
### AUGUST
otu.aug <- read.table("silva_nochloronomito_otu_table_ps5_BS2_aug.txt",sep="\t",header=TRUE, row.names=1)
samples.aug<-read.table("metadata_ps5_BS2_aug.txt",sep="\t",header=T,row.names=1)
samples.aug$Treatment<-factor(samples.aug$Treatment,levels=c("probiotic bag","probiotic paste","control bag","control paste","none","resistant"))
samples.aug$Condition<-factor(samples.aug$Condition,levels=c("HH","HD","DD"))
d.czm <- cmultRepl(t(otu.aug), method="CZM", label=0, z.warning=1)
d.clr <- codaSeq.clr(d.czm)
E.clr <- t(d.clr)
d.pcx <- prcomp(E.clr)
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
df_out.aug <- as.data.frame(d.pcx$x)
p1<-ggplot(df_out.aug,aes(x=PC1,y=PC2,color=samples.aug$Treatment,shape=samples.aug$Condition))
p1<-p1+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Treatment")+
ylim(-100,100)+
xlim(-100,100)+
coord_fixed(ratio=1)
### OCTOBER
otu.oct <- read.table("silva_nochloronomito_otu_table_ps5_BS2_oct.txt",sep="\t",header=TRUE, row.names=1)
samples.oct<-read.table("metadata_ps5_BS2_oct.txt",sep="\t",header=T,row.names=1)
samples.oct$Treatment<-factor(samples.oct$Treatment,levels=c("probiotic bag","probiotic paste","control bag","control paste","none","resistant"))
samples.oct$Condition<-factor(samples.oct$Condition,levels=c("HH","HD","DD"))
d.czm <- cmultRepl(t(otu.oct), method="CZM", label=0, z.warning=1)
d.clr <- codaSeq.clr(d.czm)
E.clr <- t(d.clr)
d.pcx <- prcomp(E.clr)
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
df_out.oct <- as.data.frame(d.pcx$x)
p2<-ggplot(df_out.oct,aes(x=PC1,y=PC2,color=samples.oct$Treatment,shape=samples.oct$Condition))
p2<-p2+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Treatment")+
ylim(-100,100)+
xlim(-100,100)+
coord_fixed(ratio=1)
### JANUARY
otu.jan <- read.table("silva_nochloronomito_otu_table_ps5_BS2_jan.txt",sep="\t",header=TRUE, row.names=1)
samples.jan<-read.table("metadata_ps5_BS2_jan.txt",sep="\t",header=T,row.names=1)
samples.jan$Treatment<-factor(samples.jan$Treatment,levels=c("probiotic bag","probiotic paste","control bag","control paste","none","resistant"))
samples.jan$Condition<-factor(samples.jan$Condition,levels=c("HH","HD","DD"))
d.czm <- cmultRepl(t(otu.jan), method="CZM", label=0, z.warning=1)
d.clr <- codaSeq.clr(d.czm)
E.clr <- t(d.clr)
d.pcx <- prcomp(E.clr)
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
df_out.jan <- as.data.frame(d.pcx$x)
p3<-ggplot(df_out.jan,aes(x=PC1,y=PC2,color=samples.jan$Treatment,shape=samples.jan$Condition))
p3<-p3+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Treatment")+
ylim(-100,100)+
xlim(-100,100)+
coord_fixed(ratio=1)
#cowplot shared legends vignette: https://wilkelab.org/cowplot/articles/shared_legends.html
#get legend no longer works - use inkscape to add legend
pdf("PCA-3panels.pdf",bg ="white",width=12,height=4.5)
panels<-plot_grid(
p1+theme(legend.position="none"),
p2+theme(legend.position="none"),
p3+theme(legend.position="none"),
align = 'vh',
labels=c("Before treatment","Two weeks after treatment","Two months after treatment"),
nrow=1)
panels
dev.off()
# use an ASV table that has been filtered to remove low-abundance ASVs, no blanks
otu <- read.table("silva_nochloronomito_otu_table_ps5_BS2.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps5_BS2.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps5_BS2.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps5_BS2 <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps5_BS2 #755 taxa and 194 samples
# First, replace 0 values with an estimate (because normalization is taking log, can't have 0)
# Also transposing here, need samples as rows
d.czm <- cmultRepl(t(otu), method="CZM", label=0, z.warning=1)
# Perform the center-log-ratio (CLR) transformation
d.clr <- codaSeq.clr(d.czm)
# transpose matrix of CLR transformed data for ordination and dendrogram
E.clr <- t(d.clr)
# plot compositional PCA biplot (perform a singular value decomposition)
d.pcx <- prcomp(E.clr)
# calculate percent variance explained for the axis labels
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
#biplot(d.pcx, cex=c(0.6,0.4), var.axes=F,scale=1, xlab=xlab, ylab=ylab)
summary(d.pcx)
str(d.pcx)
screeplot(d.pcx)
# replot PCA with ggplot2 (showing samples only)
df_out <- as.data.frame(d.pcx$x)
theme_set(theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()))
cols<-c("resistant"="#000000","none"="#999999","probiotic paste"="#D55E00","probiotic bag"="#E69F00","control paste"="#0072B2","control bag"="#56B4E9")
samples$Treatment<-factor(samples$Treatment,levels=c("probiotic bag","probiotic paste","control bag","control paste","none","resistant"))
samples$Collection.month<-factor(samples$Collection.month,levels=c("Aug","Oct","Jan"))
samples$Condition<-factor(samples$Condition,levels=c("HH","HD","DD"))
pdf("PCA.pdf",bg ="white",width = 8.5)
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$Treatment,shape=samples$Condition))
p<-p+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
facet_grid(~samples$Collection.month)
p + labs(x=xlab, y=ylab, color="Treatment",shape="Condition") +coord_fixed()
dev.off()
####### Perform permanova using Aitchison distance
dist.clr <- dist(E.clr)
perm<-adonis2(dist.clr~Condition*Treatment,as(sample_data(ps5_BS2),"data.frame"))
print(perm)
otu <- read.table("silva_nochloronomito_otu_table_ps5_BS2_aug.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps5_BS2_aug.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps5_BS2_aug.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps5_BS2_aug <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps5_BS2_aug  #755 taxa and 60 samples
d.czm <- cmultRepl(t(otu), method="CZM", label=0, z.warning=1)
d.clr <- codaSeq.clr(d.czm)
E.clr <- t(d.clr)
d.pcx <- prcomp(E.clr)
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
df_out.aug <- as.data.frame(d.pcx$x)
theme_set(theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()))
cols<-c("resistant"="#000000","none"="#999999","probiotic paste"="#D55E00","probiotic bag"="#E69F00","control paste"="#0072B2","control bag"="#56B4E9")
samples$Treatment<-factor(samples$Treatment,levels=c("probiotic bag","probiotic paste","control bag","control paste","none","resistant"))
samples$Condition<-factor(samples$Condition,levels=c("HH","HD","DD"))
pdf("PCA_Aug.pdf",bg ="white",width = 8.5)
p1<-ggplot(df_out.aug,aes(x=PC1,y=PC2,color=samples$Treatment,shape=samples$Condition))
p1<-p1+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Treatment",shape="Condition") +coord_fixed()
p1
dev.off()
# Perform permanova using Aitchison distance
dist.clr <- dist(E.clr)
perm<-adonis2(dist.clr~Condition,as(sample_data(ps5_BS2_aug),"data.frame"))
print(perm)
pdf("PCA_Aug.pdf",bg ="white",width = 8.5)
p1<-ggplot(df_out.aug,aes(x=PC1,y=PC2,color=samples$Treatment,shape=samples$Condition))
otu <- read.table("silva_nochloronomito_otu_table_ps5_BS2_aug.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps5_BS2_aug.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps5_BS2_aug.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps5_BS2_aug <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps5_BS2_aug  #755 taxa and 60 samples
d.czm <- cmultRepl(t(otu), method="CZM", label=0, z.warning=1)
d.clr <- codaSeq.clr(d.czm)
E.clr <- t(d.clr)
d.pcx <- prcomp(E.clr)
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
df_out.aug <- as.data.frame(d.pcx$x)
theme_set(theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()))
cols<-c("resistant"="#000000","none"="#999999","probiotic paste"="#D55E00","probiotic bag"="#E69F00","control paste"="#0072B2","control bag"="#56B4E9")
samples$Treatment<-factor(samples$Treatment,levels=c("probiotic bag","probiotic paste","control bag","control paste","none","resistant"))
samples$Condition<-factor(samples$Condition,levels=c("HH","HD","DD"))
pdf("PCA_Aug.pdf",bg ="white",width = 8.5)
p1<-ggplot(df_out.aug,aes(x=PC1,y=PC2,color=samples$Treatment,shape=samples$Condition))
p1<-p1+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, shape="Condition",color="Treatment") +coord_fixed()
p1
dev.off()
pdf("PCA_Aug.pdf",bg ="white",width = 8.5)
p1<-ggplot(df_out.aug,aes(x=PC1,y=PC2,shape=samples$Condition,color=samples$Treatment))
p1<-p1+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab,shape="Condition",color="Treatment") +coord_fixed()
p1
dev.off()
otu <- read.table("silva_nochloronomito_otu_table_ps5_BS2_oct.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps5_BS2_oct.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps5_BS2_oct.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps5_BS2_oct <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps5_BS2_oct  #755 taxa and 71 samples
d.czm <- cmultRepl(t(otu), method="CZM", label=0, z.warning=1)
d.clr <- codaSeq.clr(d.czm)
E.clr <- t(d.clr)
d.pcx <- prcomp(E.clr)
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
df_out.oct <- as.data.frame(d.pcx$x)
theme_set(theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()))
cols<-c("resistant"="#000000","none"="#999999","probiotic paste"="#D55E00","probiotic bag"="#E69F00","control paste"="#0072B2","control bag"="#56B4E9")
samples$Treatment<-factor(samples$Treatment,levels=c("probiotic bag","probiotic paste","control bag","control paste","none","resistant"))
samples$Condition<-factor(samples$Condition,levels=c("HH","HD","DD"))
pdf("PCA_Oct.pdf",bg ="white",width = 8.5)
p2<-ggplot(df_out.oct,aes(x=PC1,y=PC2,color=samples$Treatment,shape=samples$Condition))
p2<-p2+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Treatment",shape="Condition") +coord_fixed()
p2
dev.off()
otu <- read.table("silva_nochloronomito_otu_table_ps5_BS2_jan.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps5_BS2_jan.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps5_BS2_jan.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps5_BS2_jan <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps5_BS2_jan  #755 taxa and 63 samples
d.czm <- cmultRepl(t(otu), method="CZM", label=0, z.warning=1)
d.clr <- codaSeq.clr(d.czm)
E.clr <- t(d.clr)
d.pcx <- prcomp(E.clr)
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
df_out.jan <- as.data.frame(d.pcx$x)
theme_set(theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()))
cols<-c("resistant"="#000000","none"="#999999","probiotic paste"="#D55E00","probiotic bag"="#E69F00","control paste"="#0072B2","control bag"="#56B4E9")
samples$Treatment<-factor(samples$Treatment,levels=c("probiotic bag","probiotic paste","control bag","control paste","none","resistant"))
samples$Condition<-factor(samples$Condition,levels=c("HH","HD","DD"))
pdf("PCA_Jan.pdf",bg ="white",width = 8.5)
p3<-ggplot(df_out.jan,aes(x=PC1,y=PC2,color=samples$Treatment,shape=samples$Condition))
p3<-p3+geom_point(size=2)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Treatment",shape="Condition") +coord_fixed()
p3
dev.off()
otu <- read.table("silva_nochloronomito_otu_table_ps5_BS2.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps5_BS2.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps5_BS2.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps
ps_ra<-transform_sample_counts(ps, function(OTU) OTU/sum(OTU))
ps_ra
otu <- read.table("silva_nochloronomito_otu_table_ps5_BS2.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps5_BS2.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps5_BS2.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps5_BS2 <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps5_BS2
d.czm <- cmultRepl(t(otu), method="CZM", label=0, z.warning=1)
# Perform the center-log-ratio (CLR) transformation
d.clr <- codaSeq.clr(d.czm)
# transpose matrix of CLR transformed data for ordination and dendrogram
E.clr <- t(d.clr)
# plot compositional PCA biplot (perform a singular value decomposition)
d.pcx <- prcomp(E.clr)
# calculate percent variance explained for the axis labels
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
dist.clr <- dist(E.clr)
perm<-adonis2(dist.clr~Condition*Treatment*Collection.month,as(sample_data(ps5_BS2),"data.frame"))
print(perm)
